# War3 æˆ˜ç½‘å¤§å… UI äº‹ä»¶åˆ†å‘é€»è¾‘ (Lobby Event Dispatch)

## 1. åŸºç¡€ä¿¡æ¯

*   **æ¨¡å—åç§°**: `Game.dll`
*   **å½“å‰åŸºå€**: `02690000`
*   **ä»£ç ä½ç½®**: `02C4B2A0`
*   **åˆ†å‘æœºåˆ¶**: 
    1.  æ¥æ”¶äº‹ä»¶ ID (`ECX`)ã€‚
    2.  æ£€æŸ¥ ID æ˜¯å¦è¶Šç•Œ (æœ€å¤§å€¼æ£€æŸ¥)ã€‚
    3.  é€šè¿‡ **è·³è½¬è¡¨ (Jump Table)** `jmp dword ptr ds:[ecx*4 + TableBase]` è·³è½¬åˆ°å¯¹åº”åˆ†æ”¯ã€‚
    4.  æ¯ä¸ªåˆ†æ”¯è°ƒç”¨å…·ä½“çš„å¤„ç†å‡½æ•° (`call game.xxxxxxx`)ã€‚

## 2. æ ¸å¿ƒåŠŸèƒ½æ˜ å°„è¡¨ (Event Mapping)

ä»¥ä¸‹è¡¨æ ¼æ ¹æ® `ECX` å¯„å­˜å™¨çš„å€¼ï¼ˆäº‹ä»¶IDï¼‰åˆ†ç±»ã€‚åœ°å€åŸºäºä½ æä¾›çš„ Dumpï¼ˆ`02C4xxxx` æ®µï¼‰ã€‚

### ğŸ¯ æ¸¸æˆæ¨¡å¼é€‰æ‹© (Game Modes)

| Event ID (Hex) | Event ID (Dec) | åŠŸèƒ½æè¿° (Description) | å…³é”®å‡½æ•°åœ°å€ (Call) | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- | :--- |
| **0x00** | 0 | **Play Game (ç©æ¸¸æˆ)** | `game.2C48790` | æ­¤æ—¶ `ecx=0` |
| **0x01** | 1 | **Quick Game (å¿«é€Ÿæ¸¸æˆ)** | `game.2C487A0` | æ­¤æ—¶ `ecx=1` |
| **0x02** | 2 | **Arrange Team (å®‰æ’é˜Ÿä¼)** | `game.2C48840` | |
| **0x03** | 3 | **Custom Game (è‡ªå®šä¹‰æ¸¸æˆ)** | `game.2C48830` | ğŸš© **æ ¸å¿ƒå…³æ³¨ç›®æ ‡** |
| **0x04** | 4 | **Tournaments (é”¦æ ‡èµ›)** | `game.2C41C50` | |
| **0x34** | 52 | **Match Start (å¼€å§‹åŒ¹é…)** | `game.2C415B0` | ç‚¹å‡»å¿«é€Ÿæ¸¸æˆåçš„å‡†å¤‡é˜¶æ®µ |
| **0x35** | 53 | **Cancel Match (å–æ¶ˆ/Esc)** | `game.2C02150` | é€€å‡ºåŒ¹é…é˜Ÿåˆ— |

### ğŸ’¬ ç¤¾äº¤ä¸é¢‘é“ (Chat & Community)

| Event ID (Hex) | Event ID (Dec) | åŠŸèƒ½æè¿° (Description) | å…³é”®å‡½æ•°åœ°å€ (Call) | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- | :--- |
| **0x0A** | 10 | **Select Channel (é€‰æ‹©é¢‘é“)** | `game.2C14590` | è¿›å…¥é¢‘é“é€‰æ‹©ç•Œé¢ |
| **0x0B** | 11 | **Enter Chat (è¿›å…¥èŠå¤©)** | `game.2C14550` | èŠå¤©æŒ‰é’® |
| **0x0E** | 14 | **Double Click Channel** | `game.2C41AD0` | åŒå‡»é¢‘é“åˆ—è¡¨é¡¹ |
| **0x12** | 18 | **Select Channel List** | `game.2C020D0` | å•å‡»/é€‰æ‹©é¢‘é“åˆ—è¡¨ |
| **0x1B** | 27 | **Tab Switch** | `game.2C47B80` | åˆ‡æ¢ Channel/Friends/Clan æ ‡ç­¾é¡µ |
| **0x1D** | 29 | **Chat Send (å‘é€æ¶ˆæ¯)** | `game.2C4A720` | åœ¨è¾“å…¥æ¡†å›è½¦å‘é€ |
| **0x3A** | 58 | **Chat UI Init** | `game.2C8DEC0` | èŠå¤©ç•Œé¢åˆå§‹åŒ– |
| **0x3B** | 59 | **Chat Switch Done** | `game.2C27290` | èŠå¤©é¡µé¢åˆ‡æ¢å®Œæˆ |
| **0x3D** | 61 | **Chat Switch Start** | `game.2C02A60` | èŠå¤©é¡µé¢åˆ‡æ¢å¼€å§‹ |

### ğŸ‘¥ å¥½å‹ç³»ç»Ÿ (Friends List)

| Event ID (Hex) | Event ID (Dec) | åŠŸèƒ½æè¿° (Description) | å…³é”®å‡½æ•°åœ°å€ (Call) | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- | :--- |
| **0x16** | 22 | **Click Friend (å•å‡»å¥½å‹)** | `game.2C48170` | é€‰ä¸­å¥½å‹ |
| **0x17** | 23 | **Double Click Friend** | `game.2C48280` | åŒå‡»å¥½å‹ï¼ˆé€šå¸¸æ˜¯å‘æ¶ˆæ¯æˆ–åŠ å…¥ï¼‰ |
| **0x27** | 39 | **Add Friend (æ·»åŠ å¥½å‹)** | `game.2C411A0` | ç‚¹å‡»æ·»åŠ æŒ‰é’® |
| **0x2C** | 44 | **Get Friend Info** | `game.2C4A790` | è·å–å¥½å‹ä¿¡æ¯ (å¯èƒ½å¤šæ¬¡è§¦å‘) |
| **0x3C** | 60 | **Update Friend List** | `game.2C41EC0` | åˆ·æ–°/è·å–å¥½å‹åˆ—è¡¨ |

### âš™ï¸ ç³»ç»Ÿä¸èµ„æ–™ (System & Profile)

| Event ID (Hex) | Event ID (Dec) | åŠŸèƒ½æè¿° (Description) | å…³é”®å‡½æ•°åœ°å€ (Call) | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- | :--- |
| **0x07** | 7 | **Ladder Info (å¤©æ¢¯ä¿¡æ¯)** | `game.2C41B90` | |
| **0x08** | 8 | **Profile (ä¸ªäººèµ„æ–™)** | `game.2C488D0` | ç‚¹å‡»å¤´åƒ/èµ„æ–™æŒ‰é’® |
| **0x0C** | 12 | **Exit Lobby (é€€å‡ºå¤§å…)** | `game.2C48910` | è¿”å›ä¸Šä¸€çº§èœå• |
| **0x0D** | 13 | **Help (å¸®åŠ©/é—®å·)** | `game.2C21290` | å³ä¸Šè§’é—®å· |
| **0x1C** | 28 | **Close Dialog** | `game.2C140E0` | å…³é—­å¼¹çª— |
| **0x25** | 37 | **Dialog Yes** | `game.2C41210` | ç¡®è®¤æ¡†ç‚¹å‡»â€œæ˜¯â€ |
| **0x26** | 38 | **Dialog No** | `game.2C41260` | ç¡®è®¤æ¡†ç‚¹å‡»â€œå¦â€ |

### ğŸ”„ çŠ¶æ€æµè½¬ä¸æ–°é—» (State & News)

| Event ID (Hex) | Event ID (Dec) | åŠŸèƒ½æè¿° (Description) | å…³é”®å‡½æ•°åœ°å€ (Call) | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- | :--- |
| **0x2A** | 42 | **News Fetch (3)** | `game.2C14420` | è¿›å…¥æˆ˜ç½‘åç¬¬3æ¬¡è§¦å‘ |
| **0x2B** | 43 | **Channel List Done** | `game.2C412F0` | è·å–é¢‘é“åˆ—è¡¨å®Œæ¯• |
| **0x3E** | 62 | **News Fetch (1)** | `game.2699E30` | åˆšè¿›å…¥å¤§å…æ—¶è§¦å‘ |
| **0x3F** | 63 | **Transition End** | `game.2C03020` | ç”»é¢åˆ‡æ¢ç»“æŸ (å¦‚è¿›å…¥è‡ªå®šä¹‰æˆ¿é—´) |
| **0x40** | 64 | **News Fetch (2)** | `game.2CA7650` | è¿›å…¥å¤§å…åç¬¬2æ¬¡è§¦å‘ |
| **0x41** | 65 | **Transition Start** | `game.2CA7650` | ç”»é¢åˆ‡æ¢å¼€å§‹ (é€€å‡ºå¤§å…æ—¶) |

## 3. å…³é”®æ±‡ç¼–é€»è¾‘ç‰‡æ®µ

### è‡ªå®šä¹‰æ¸¸æˆå…¥å£ (Target)
```assembly
02C4B2D2  | 8BCE          | mov ecx,esi       ; æ¢å¤ ECX (Event ID)
02C4B2D4  | E8 57D5FFFF   | call game.2C48830 ; <--- è¿›å…¥è‡ªå®šä¹‰æ¸¸æˆåˆ—è¡¨çš„æ ¸å¿ƒå‡½æ•°
```

### èŠå¤©è¾“å…¥å‘é€
```assembly
02C4B365  | 8BCE          | mov ecx,esi       ; æ¢å¤ ECX
02C4B367  | E8 B4F3FFFF   | call game.2C4A720 ; <--- å‘é€èŠå¤©æ¶ˆæ¯
```

### é€€å‡ºæˆ˜ç½‘é€»è¾‘
```assembly
02C4B337  | 6A 00         | push 0
02C4B339  | 8BCE          | mov ecx,esi
02C4B33B  | E8 D0D5FFFF   | call game.2C48910 ; <--- é€€å‡ºæ“ä½œ
```

## 4. æ€»ç»“ä¸å»ºè®®

1.  **Hook å»ºè®®**:
    å¦‚æœä½ æƒ³æ‹¦æˆªç©å®¶ç‚¹å‡»â€œè‡ªå®šä¹‰æ¸¸æˆâ€çš„è¡Œä¸ºï¼ˆä¾‹å¦‚æ›¿æ¢ä¸ºæ˜¾ç¤ºä½ çš„äº‘æˆ¿é—´åˆ—è¡¨ï¼‰ï¼Œä½ åº”è¯¥ Hook åœ°å€ **`02C4B2D4`** å¤„çš„ `call` æŒ‡ä»¤ï¼Œæˆ–è€…ç›´æ¥ Hook ç›®æ ‡å‡½æ•° **`game.2C48830`**ã€‚

2.  **æ•°æ®åŒ…å‘é€æ—¶æœº**:
    åœ¨ `0x1D` (Chat Send) äº‹ä»¶ä¸­ï¼Œå¯ä»¥æ‹¦æˆªç©å®¶çš„èŠå¤©è¾“å…¥ã€‚
    åœ¨ `0x00` (Play Game) æˆ– `0x03` (Custom Game) äº‹ä»¶ä¸­ï¼Œæ˜¯æ³¨å…¥è‡ªå®šä¹‰é€»è¾‘çš„æœ€ä½³æ—¶æœºã€‚

3.  **UI åˆ·æ–°**:
    `0x3C`, `0x2C` ç­‰äº‹ä»¶é¢‘ç¹è§¦å‘ï¼Œè¡¨æ˜è¿™æ˜¯ UI è½®è¯¢æˆ–å›è°ƒæœºåˆ¶ã€‚å¦‚æœä½ çš„ DLL éœ€è¦ç»˜åˆ¶ Overlayï¼Œéœ€æ³¨æ„ä¸è¦åœ¨è¿™äº›é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ä¸­åšè€—æ—¶æ“ä½œï¼Œå¦åˆ™ä¼šå¡é¡¿ã€‚